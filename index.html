<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kamera Geotag Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: white;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100vw;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .camera-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        
        #video, #canvas {
            width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        #canvas {
            display: none;
        }
        
        .overlay {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            min-width: 300px;
            max-width: 90%;
        }
        
        .overlay-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .app-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(45deg, #4285f4, #34a853);
            border-radius: 6px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .app-name {
            color: white;
            font-weight: 500;
            font-size: 14px;
        }
        
        .location-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
            color: white;
        }
        
        .address {
            font-size: 12px;
            color: #ccc;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .coordinates {
            font-size: 12px;
            color: #ccc;
            margin-bottom: 5px;
        }
        
        .timestamp {
            font-size: 12px;
            color: #ccc;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #4285f4, #34a853);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .edit-panel {
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            width: 100%;
            max-width: 600px;
        }
        
        .edit-panel h3 {
            margin-bottom: 15px;
            color: #4285f4;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
            font-size: 14px;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .captured-image {
            position: relative;
            margin-top: 20px;
        }
        
        .captured-image img {
            width: 100%;
            max-width: 600px;
            border-radius: 10px;
        }
        
        .download-btn {
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .overlay {
                bottom: 10px;
                right: 10px;
                left: 10px;
                min-width: auto;
                max-width: none;
            }
            
            .controls {
                gap: 10px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="camera-section">
            <div class="camera-container">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
                
                <div class="overlay" id="overlay">
                    <div class="overlay-header">
                        <div class="app-icon">üìç</div>
                        <div class="app-name">GPS Map Camera</div>
                    </div>
                    <div class="location-title" id="locationTitle">Kecamatan Genteng, Jawa Timur, Indonesia</div>
                    <div class="address" id="address">Tunjungan Electronic Centre, Jl. Tunjungan Lantai G, Blok 12, Genteng, Kec. Genteng, Surabaya, Jawa Timur 60275, Indonesia</div>
                    <div class="coordinates" id="coordinates">Lat -7.256603¬∞ Long 112.737743¬∞</div>
                    <div class="timestamp" id="timestamp">21/08/2025 07:43 AM GMT +07:00</div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn btn-primary" onclick="startCamera()">üìπ Start Camera</button>
                <button class="btn btn-primary" onclick="capturePhoto()">üì∑ Ambil Foto</button>
                <button class="btn btn-secondary" onclick="getCurrentLocation()">üìç Auto Lokasi</button>
                <button class="btn btn-secondary" onclick="toggleEditPanel()">‚úèÔ∏è Edit Info</button>
            </div>
            
            <div class="edit-panel" id="editPanel" style="display: none;">
                <h3>üìù Edit Informasi Geotag</h3>
                
                <div class="form-group">
                    <label>Judul Lokasi:</label>
                    <input type="text" id="editTitle" placeholder="Masukkan judul lokasi">
                </div>
                
                <div class="form-group">
                    <label>Alamat Lengkap:</label>
                    <textarea id="editAddress" placeholder="Masukkan alamat lengkap"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Latitude:</label>
                        <input type="number" id="editLat" step="any" placeholder="-7.256603">
                    </div>
                    <div class="form-group">
                        <label>Longitude:</label>
                        <input type="number" id="editLng" step="any" placeholder="112.737743">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Nama Aplikasi:</label>
                    <input type="text" id="editAppName" placeholder="GPS Map Camera">
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" onclick="updateOverlay()">üíæ Update Info</button>
                    <button class="btn btn-secondary" onclick="resetToDefault()">üîÑ Reset Default</button>
                </div>
            </div>
            
            <div class="captured-image" id="capturedResult" style="display: none;">
                <img id="resultImage" alt="Captured photo">
                <div class="controls">
                    <button class="btn btn-primary download-btn" onclick="downloadImage()">üíæ Download Foto</button>
                    <button class="btn btn-secondary" onclick="resetCapture()">üîÑ Ambil Lagi</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let video, canvas, ctx, stream;
        let currentLocationData = {
            title: "Kecamatan Genteng, Jawa Timur, Indonesia",
            address: "Tunjungan Electronic Centre, Jl. Tunjungan Lantai G, Blok 12, Genteng, Kec. Genteng, Surabaya, Jawa Timur 60275, Indonesia",
            lat: -7.256603,
            lng: 112.737743,
            appName: "GPS Map Camera"
        };

        function init() {
            video = document.getElementById('video');
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            
            updateTimestamp();
            setInterval(updateTimestamp, 1000);
            
            // Load saved data
            loadEditFields();
        }

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    } 
                });
                video.srcObject = stream;
                video.style.display = 'block';
                document.getElementById('capturedResult').style.display = 'none';
            } catch (err) {
                alert('Error mengakses kamera: ' + err.message);
                console.error('Camera error:', err);
            }
        }

        function capturePhoto() {
            if (!stream) {
                alert('Silakan start camera terlebih dahulu!');
                return;
            }

            // Set canvas size to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw video frame
            ctx.drawImage(video, 0, 0);
            
            // Draw overlay
            drawOverlay();
            
            // Show result
            const dataURL = canvas.toDataURL('image/jpeg', 0.9);
            document.getElementById('resultImage').src = dataURL;
            document.getElementById('capturedResult').style.display = 'block';
            
            // Hide video
            video.style.display = 'none';
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
        }

        function drawOverlay() {
            const overlayWidth = Math.min(350, canvas.width * 0.6);
            const overlayHeight = 1400;
            const padding = 20;
            const x = canvas.width - overlayWidth - padding;
            const y = canvas.height - overlayHeight - padding;
            
            // Background with blur effect
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(x, y, overlayWidth, overlayHeight);
            
            // Header
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('üìç ' + currentLocationData.appName, x + 15, y + 25);
            
            // Location title
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 16px Arial';
            const titleLines = wrapText(ctx, currentLocationData.title, overlayWidth - 30);
            let currentY = y + 45;
            titleLines.forEach(line => {
                ctx.fillText(line, x + 15, currentY);
                currentY += 18;
            });
            
            // Address
            ctx.fillStyle = '#cccccc';
            ctx.font = '11px Arial';
            const addressLines = wrapText(ctx, currentLocationData.address, overlayWidth - 30);
            currentY += 5;
            addressLines.forEach(line => {
                ctx.fillText(line, x + 15, currentY);
                currentY += 13;
            });
            
            // Coordinates
            currentY += 5;
            ctx.fillText(`Lat ${currentLocationData.lat}¬∞ Long ${currentLocationData.lng}¬∞`, x + 15, currentY);
            
            // Timestamp
            currentY += 15;
            const now = new Date();
            const timestamp = now.toLocaleString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            }) + ' WIB';
            ctx.fillText(timestamp, x + 15, currentY);
        }

        function wrapText(ctx, text, maxWidth) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                const width = ctx.measureText(currentLine + ' ' + word).width;
                if (width < maxWidth) {
                    currentLine += ' ' + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);
            return lines;
        }

        async function getCurrentLocation() {
            if (!navigator.geolocation) {
                alert('Geolocation tidak didukung di browser ini.');
                return;
            }

            navigator.geolocation.getCurrentPosition(async (position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                
                try {
                    // Using a reverse geocoding service (you might want to replace with your preferred service)
                    const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lng}&localityLanguage=id`);
                    const data = await response.json();
                    
                    currentLocationData = {
                        title: data.city + ', ' + data.principalSubdivision + ', ' + data.countryName,
                        address: data.locality + ', ' + data.city + ', ' + data.principalSubdivision + ', ' + data.countryName,
                        lat: lat,
                        lng: lng,
                        appName: currentLocationData.appName
                    };
                    
                    updateOverlay();
                    loadEditFields();
                } catch (error) {
                    // Fallback if geocoding fails
                    currentLocationData.lat = lat;
                    currentLocationData.lng = lng;
                    updateOverlay();
                    loadEditFields();
                }
            }, (error) => {
                alert('Error mendapatkan lokasi: ' + error.message);
            });
        }

        function toggleEditPanel() {
            const panel = document.getElementById('editPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function loadEditFields() {
            document.getElementById('editTitle').value = currentLocationData.title;
            document.getElementById('editAddress').value = currentLocationData.address;
            document.getElementById('editLat').value = currentLocationData.lat;
            document.getElementById('editLng').value = currentLocationData.lng;
            document.getElementById('editAppName').value = currentLocationData.appName;
        }

        function updateOverlay() {
            currentLocationData = {
                title: document.getElementById('editTitle').value || currentLocationData.title,
                address: document.getElementById('editAddress').value || currentLocationData.address,
                lat: parseFloat(document.getElementById('editLat').value) || currentLocationData.lat,
                lng: parseFloat(document.getElementById('editLng').value) || currentLocationData.lng,
                appName: document.getElementById('editAppName').value || currentLocationData.appName
            };
            
            // Update overlay display
            document.getElementById('locationTitle').textContent = currentLocationData.title;
            document.getElementById('address').textContent = currentLocationData.address;
            document.getElementById('coordinates').textContent = `Lat ${currentLocationData.lat}¬∞ Long ${currentLocationData.lng}¬∞`;
            document.querySelector('.app-name').textContent = currentLocationData.appName;
            
            toggleEditPanel();
        }

        function resetToDefault() {
            currentLocationData = {
                title: "Kecamatan Genteng, Jawa Timur, Indonesia",
                address: "Tunjungan Electronic Centre, Jl. Tunjungan Lantai G, Blok 12, Genteng, Kec. Genteng, Surabaya, Jawa Timur 60275, Indonesia",
                lat: -7.256603,
                lng: 112.737743,
                appName: "GPS Map Camera"
            };
            loadEditFields();
            updateOverlay();
        }

        function updateTimestamp() {
            const now = new Date();
            const timestamp = now.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            }) + ' ' + now.toLocaleTimeString('id-ID', {
                hour: '2-digit',
                minute: '2-digit'
            }) + ' WIB';
            document.getElementById('timestamp').textContent = timestamp;
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = `geotag_photo_${Date.now()}.jpg`;
            link.href = canvas.toDataURL('image/jpeg', 0.9);
            link.click();
        }

        function resetCapture() {
            document.getElementById('capturedResult').style.display = 'none';
            startCamera();
        }

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>

</html>

